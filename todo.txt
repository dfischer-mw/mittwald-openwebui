Th econtainer should be hosted on github but then this building should jappen on github as well but the Front end sets the MITTWALD APIO KEY AND BASE URL VIA FRONTEND IN N8N workflow:

Homepage
Primary navigation
Project
avatar
LLM Locksmith

Pinned

Manage

Plan

Code
Merge requests
1
Repository
Branches
Commits
Tags
Repository graph
Compare revisions
Snippets
Locked files

Build

Secure

Deploy

Operate

Monitor

Analyze

Settings
COAB 0x7e7
Services
avatarLLM Locksmith
Repository
llm-locksmith
assets
processes
Ai_Hosting___Create_Container.json
Ai_Hosting___Create_Container.json
Ruven Fehling's avatar
Unique container names
Ruven Fehling authored 1 month ago
083a99ac
 Code owners
Assign users and groups as approvers for specific file changes. Learn more.
Ai_Hosting___Create_Container.json
24.32 KiB
{
  "name": "Ai Hosting - Create Container",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "ffbda2fb-9884-4313-8d85-4d6defcedb7d",
              "leftValue": "={{ $json.openWebUIIngress }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c0539651-f402-4a4c-a640-8d3ded41a21a",
      "name": "OpenWebUI Ingress exists",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2280,
        400
      ]
    },
    {
      "parameters": {
        "domain": "llmlocksmith",
        "event": "webUiContainerRequested",
        "eventID": "543758568269021183"
      },
      "id": "a0a5c38b-1bff-4b13-8ff3-9e9d8db84ed1",
      "name": "WebUi Container Requested Event",
      "type": "n8n-nodes-mittwald.domainEventTrigger",
      "typeVersion": 1,
      "position": [
        180,
        460
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b9acddc1-86a5-4e76-b758-3a3e799ffa4a",
              "leftValue": "={{ \"error\" in $json }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "b2d4aee6-1efd-4ff6-91f2-8ed0b73098ef",
      "name": "Found containerId in stack?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1280,
        440
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b9acddc1-86a5-4e76-b758-3a3e799ffa4a",
              "leftValue": "={{ \"error\" in $json }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ac2a64de-b54a-481c-a0be-32a24c773610",
      "name": "Ingress was updated?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2680,
        240
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b9acddc1-86a5-4e76-b758-3a3e799ffa4a",
              "leftValue": "={{ \"error\" in $json }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "10a19631-e655-4f57-b634-80bb83c0a4d1",
      "name": "Ingress was created?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2680,
        580
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b9acddc1-86a5-4e76-b758-3a3e799ffa4a",
              "leftValue": "={{ \"error\" in $json }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2d6f21f5-5a0e-4141-b3e0-67d5ca6a2936",
      "name": "Container was linked?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        3180,
        400
      ]
    },
    {
      "parameters": {},
      "id": "c2ffa4e1-334b-42f7-8fa1-fc8469c11dd9",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3400,
        220
      ]
    },
    {
      "parameters": {
        "content": "## Dokumentation \n\nTLDR: Die IF-Nodes die dicht an einer anderen Note sind, schauen nach Fehlern.\n\nWir möchten beim Fehlschlagen dieses Workflow dem Kunden im Frontend einen Fehler anzeigen. Daher gibt es in dem Workflow ein besonderes Error Handling.\n\nDie meines Node haben dicht hinter sich eine If-Node diese schaut ob in der vorherigen Node ein Fehler aufgetreten ist, ist das der Fall wir der Fehler an den LLM-Locksmith geschickt. ",
        "height": 251.29172284667592,
        "width": 576.5134818803699
      },
      "id": "20360ae6-e009-417c-b035-e897d58a009d",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        280,
        157.66582027305702
      ]
    },
    {
      "parameters": {},
      "id": "c8bc8f52-5040-4e11-877d-d2fa3db164f7",
      "name": "No Operation, do nothing1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        4060,
        1240
      ]
    },
    {
      "parameters": {
        "content": "## Error Reporting\n\nWir möchten dem Kunden bei jedem Error in diesem Workflow einen Fehler im Frontend anzeigen. Dafür die oben erwähnen If-Nodes. \n\nEs kann zu Fehlern kommen die der Kunde versehentlich verursacht hat. Zum Beispiel durch ungültige Credentails seiner Container Registry. Für diese Art von Fehler möchten wir keinen Report erhalten. Allerdings für alle anderen Fehler für die der Kunde nichts kann, daher die if Node fast am Ende.",
        "height": 596.6441312547994,
        "width": 964.6630930972868
      },
      "id": "bb72f9a1-13c4-46e0-88a0-5e6853e81550",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3280,
        840
      ]
    },
    {
      "parameters": {
        "serviceName": "mittwald.llmlocksmith.v1.InternalLlmLocksmithService",
        "functionName": "SetContainerCreationError",
        "sendInputData": false,
        "functionCode": "return {\n  licenceId: $json.event.licenceId,\n  errorMessage: $json.errorMessage,\n};",
        "outputField": "errorResponse",
        "options": {}
      },
      "id": "6535d6a8-d022-4f63-892d-cdd7918d3d6e",
      "name": "Set Error Message for Licence",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        3560,
        1160
      ]
    },
    {
      "parameters": {
        "serviceName": "mittwald.ingress.v1.IngressService",
        "functionName": "SetIngressPaths",
        "sendInputData": false,
        "message": "={{ { id: $json.openWebUIIngress.id, paths: [{ \"path\": \"/\", \"container\": { \"id\": $json.containerId, \"portProtocol\": \"8080/tcp\"}  }] } }}",
        "outputField": "tmp",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "id": "a8d57f74-6bf1-4b4b-8ed0-8181b1507d6b",
      "name": "UpdateIngress",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        2540,
        240
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "serviceName": "mittwald.ingress.v1.IngressService",
        "functionName": "CreateIngress",
        "sendInputData": false,
        "message": "={{\n{\n\"id\": $json.ingressId,\n\"hostname\": \"openwebui.\" + $json.defaultIngress.hostname,\n\"projectId\": $json.event.projectId,\n\"isDefault\": false,\n\"acme\": true,\n\"paths\": [{ \"path\": \"/\", \"container\": { \"id\": $json.containerId, \"portProtocol\": \"8080/tcp\"}  }],\n\"isEnabled\": true\n}\n}}",
        "minEventID": "=",
        "outputField": "tmp",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "name": "CreateIngress",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        2540,
        580
      ],
      "id": "bc05c610-5870-4571-b301-3046299a9b61",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "serviceName": "mittwald.llmlocksmith.v1.InternalLlmLocksmithService",
        "functionName": "LinkContainerWithProjectLicence",
        "sendInputData": false,
        "functionCode": "return {\n  licenceId: $json.event.licenceId,\n  containerId: $json.containerId,\n  stackId: $json.event.projectId,\n  ingressId: $json.openWebUIIngress.id,\n};",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "id": "54839684-f5da-47fa-a2b8-491d00b6a39b",
      "name": "Link Container With Project Licence and use existing Ingress",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        2980,
        220
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "serviceName": "mittwald.llmlocksmith.v1.InternalLlmLocksmithService",
        "functionName": "LinkContainerWithProjectLicence",
        "sendInputData": false,
        "functionCode": "return {\n  licenceId: $json.event.licenceId,\n  containerId: $json.containerId,\n  stackId: $json.event.projectId,\n  ingressId: $json.ingressId,\n};",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "id": "9e986d72-3fd1-4435-9a3e-b66ace384033",
      "name": "Link Container With Project Licence",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        2980,
        560
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const uuid = require(\"@mittwald/awesome-node-utils/text/uuid\").uuid;\n\nconst fakeCipher = $json.licence.licenceKey.slice(-4).toLowerCase();\nconst serviceName = \"ai-hosting-open-webui-\"+fakeCipher;\n\nconst stack = $input.item.json.stack;\nconst service = stack.services.find((x) => x.serviceName === serviceName);\n\nif (!service.id) {\n  throw new Error(\"No container id found!\");\n}\n\n$input.item.json.containerId = service.id;\n$input.item.json.ingressId = uuid();\n\nreturn $input.item;"
      },
      "id": "59b3fc50-06a8-4f7a-a7b9-6242ef66b1da",
      "name": "Get containerId from stack",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        440
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "errorType": "errorObject",
        "errorObject": "="
      },
      "id": "9ae6dda7-edee-4629-ba1e-781fda40ad5e",
      "name": "Stop and Error",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        4060,
        1060
      ]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nconst ingresses = input.ingressResponse.ingresses;\n\nconst defaultHostname = input.defaultIngress.hostname;\n\nconst openWebUIIngress = ingresses.find((ingress) => {\n  return ingress.hostname === `openwebui.${defaultHostname}`\n});\n\nreturn {\n  ...input,\n  openWebUIIngress: openWebUIIngress,\n}"
      },
      "id": "1f0690a1-fdff-4c21-8f2b-7305be97a2c5",
      "name": "Check for OpenWebUI ingress",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2080,
        400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a8660393-70a7-4c8f-b837-3ec9fc5885ab",
              "leftValue": "={{ $json.errorMessage }}",
              "rightValue": "unknown-error",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "79f45156-d499-4cb2-85fe-b13d8cf76172",
      "name": "Is mittwald error?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        3780,
        1160
      ]
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  const errorMessage = item.json.error.details === \"registry credentials have no image access\" ? \"invalid-registry-credentials\" : \"unknown-error\";\n  \n  item.json = $node[\"WebUi Container Requested Event\"].json;\n  item.json.errorMessage = errorMessage;\n}\n\nreturn $input.all();"
      },
      "id": "ec778bb4-c4e9-4e9b-8f20-5a35966d23b1",
      "name": "Set container-creation-failed error",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3340,
        1160
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b9acddc1-86a5-4e76-b758-3a3e799ffa4a",
              "leftValue": "={{ \"error\" in $json }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2646c47e-759b-4dbc-aec3-dc2a0f7d18ee",
      "name": "Container was created?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        780,
        460
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b9acddc1-86a5-4e76-b758-3a3e799ffa4a",
              "leftValue": "={{ \"error\" in $json }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "cbbcb559-5b19-40f1-95f0-a1b1cc78c2e2",
      "name": "Default Ingress found?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1780,
        420
      ]
    },
    {
      "parameters": {
        "serviceName": "mittwald.ingress.v1.IngressQueryService",
        "functionName": "ListIngresses",
        "sendInputData": false,
        "message": "={{ { projectId: $json.event.projectId } }}",
        "executingUser": "={{ $json.userMeta.executingUserId }}",
        "outputField": "ingressResponse",
        "postCode": "const ingresses = item.ingressResponse.ingresses ?? [];\nitem.defaultIngress = ingresses.find((i) => i.isDefault);\n\nif (!item.defaultIngress) {\n  throw new Error(\"No default ingress found!\");\n}\nreturn item;",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "id": "522402c1-a4bc-4e34-9d6f-9eafe4d67dcd",
      "name": "Get Default Ingress & Ingress list",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        1600,
        420
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "serviceName": "mittwald.container.v1.StackService",
        "functionName": "PatchStack",
        "sendInputData": false,
        "functionCode": "const fakeCipher = $json.licence.licenceKey.slice(-4).toLowerCase();\nconst serviceName = \"ai-hosting-open-webui-\"+fakeCipher;\nconst volumeConfig = {};\nvolumeConfig[`${serviceName}-app-backend-data-GjP4`] = {\n   name: serviceName + \"-app-backend-data-GjP4\",\n   updateMask: { paths: [\"name\"]},\n};\n\nconst serviceConfig = {};\nserviceConfig[serviceName] = {\n   description: serviceName,\n   updateMask: { paths: [\"description\", \"serviceName\", \"volumes\", \"image\", \"ports\", \"envs\"]},\n   serviceName: serviceName,\n   volumes: [ serviceName + \"-app-backend-data-GjP4:/app/backend/data\"],\n   image: \"ghcr.io/open-webui/open-webui:latest\",\n   ports: [\"8080/tcp\"],\n   envs: {\n     OPENAI_API_KEY: $json.licence.licenceKey,\n     OPENAI_API_BASE_URL: \"https://llm.aihosting.mittwald.de/v1\"\n   },\n};\n\nreturn {\n  id: $json.event.projectId,\n  volumes: {\n    volumes: volumeConfig,\n    updateMask: { paths: [ serviceName + \"-app-backend-data-GjP4\"]},\n  },\n  services: {\n    updateMask: { paths: [ serviceName ]},\n    services: serviceConfig,\n  },\n};",
        "executingUser": "={{ $json.userMeta.executingUserId }}",
        "outputField": "stack",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "id": "0b86cdcc-cd7a-4e35-a000-d88729a175ed",
      "name": "Patch Container Stack",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        600,
        460
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "serviceName": "mittwald.llmlocksmith.v1.InternalLlmLocksmithReaderService",
        "functionName": "GetLicence",
        "sendInputData": false,
        "message": "={{ { licenceId: $json.event.licenceId } }}",
        "outputField": "licence",
        "options": {},
        "retryAndContinueOnFail": true
      },
      "id": "09cd3829-0bd5-42d0-b846-5f9ef2a6be54",
      "name": "Get Licence",
      "type": "n8n-nodes-mittwald.domainCommand",
      "typeVersion": 1,
      "position": [
        380,
        460
      ],
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenWebUI Ingress exists": {
      "main": [
        [
          {
            "node": "UpdateIngress",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CreateIngress",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WebUi Container Requested Event": {
      "main": [
        [
          {
            "node": "Get Licence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Found containerId in stack?": {
      "main": [
        [
          {
            "node": "Get Default Ingress & Ingress list",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set container-creation-failed error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ingress was updated?": {
      "main": [
        [
          {
            "node": "Link Container With Project Licence and use existing Ingress",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set container-creation-failed error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ingress was created?": {
      "main": [
        [
          {
            "node": "Link Container With Project Licence",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set container-creation-failed error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Container was linked?": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set container-creation-failed error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Error Message for Licence": {
      "main": [
        [
          {
            "node": "Is mittwald error?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UpdateIngress": {
      "main": [
        [
          {
            "node": "Ingress was updated?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CreateIngress": {
      "main": [
        [
          {
            "node": "Ingress was created?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Link Container With Project Licence and use existing Ingress": {
      "main": [
        [
          {
            "node": "Container was linked?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Link Container With Project Licence": {
      "main": [
        [
          {
            "node": "Container was linked?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get containerId from stack": {
      "main": [
        [
          {
            "node": "Found containerId in stack?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check for OpenWebUI ingress": {
      "main": [
        [
          {
            "node": "OpenWebUI Ingress exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is mittwald error?": {
      "main": [
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set container-creation-failed error": {
      "main": [
        [
          {
            "node": "Set Error Message for Licence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Container was created?": {
      "main": [
        [
          {
            "node": "Get containerId from stack",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set container-creation-failed error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Ingress found?": {
      "main": [
        [
          {
            "node": "Check for OpenWebUI ingress",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set container-creation-failed error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Default Ingress & Ingress list": {
      "main": [
        [
          {
            "node": "Default Ingress found?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Patch Container Stack": {
      "main": [
        [
          {
            "node": "Container was created?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Licence": {
      "main": [
        [
          {
            "node": "Patch Container Stack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "89"
  },
  "versionId": "1a8fa55c-dabd-4a8f-8bd6-e19fc450ea23",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f058efe2a704e382b6ce0b691cf6653ba025932c93972ff1d531547ce02c22cc"
  },
  "id": "noErfuY5pJBmA6dK",
  "tags": [
    {
      "createdAt": "2023-03-01T09:56:48.984Z",
      "updatedAt": "2023-03-07T13:04:53.489Z",
      "id": "57",
      "name": "team-csi"
    },
    {
      "createdAt": "2025-06-25T12:46:51.842Z",
      "updatedAt": "2025-06-25T12:46:51.842Z",
      "id": "9f92oSEX9tDY0V2P",
      "name": "repo:llm-locksmith"
    },
    {
      "createdAt": "2025-06-25T12:47:49.258Z",
      "updatedAt": "2025-06-25T12:47:49.258Z",
      "id": "YzU0kaSOkryMEGTw",
      "name": "ai-hosting"
    }
  ]
}






D
F
Projekt
Daniels Testserver siuuuuuuu
Allgemeines
Dashboard
Monitoring
Leistungsanalyse
Komponenten
Apps
Container
AI-Hosting
Domains
E-Mails
neu
Datenbanken
Backups
Cronjobs
SSH/SFTP
Verwaltung
Mitglieder
Extensions
Einstellungen
Projekt
Container
Container-Details
ai-hosting-open-webui-dkma

Aktionen
Details
Entrypoint
Volumes
Umgebungsvariablen
Ports
Logs
Umgebungsvariablen

Bearbeiten
Verwende Umgebungsvariablen zur Konfiguration und für Secrets. Wir schlagen einige vor, aber nicht alle sind sinnvoll oder vollständig. Im Zweifel empfehlen wir einen Blick in die Dokumentation zum Image.
Key	Value	KI-Unterstützung
OPENAI_API_BASE_URL	https://llm.aihosting.mittwald.de/v1	–
OPENAI_API_KEY	•••••••••	–
Datenschutz
Impressum


n8n
Share your workflows with 40k+ users, unlock perks, and shine as a featured template creator!


84 updates
W.
Wer das liest ist doof .

























Back to canvas


Input
WebUi Container Requested Even... 
No input data yet
(From the earliest node that has no output data yet)
Output
Test this node to output data
or insert test data

Get Licence 
Parameters
Docs
Service Name
mittwald.llmlocksmith.v1.InternalLlmLocksmithReaderService
Function Name
GetLicence
Send Input Data

Message
{{ { licenceId: $json.event.licenceId } }}
 
FunctionItem Message
1

minEventID
executingUser
Output Field
licence
Metadata Output Field
Post Processing FunctionItem
1
return item;
Options
No properties
gRPC Retry Calls
3
use retry and continue on fail

 I wish this node would...
n8n
Share your workflows with 40k+ users, unlock perks, and shine as a featured template creator!


84 updates
W.
Wer das liest ist doof .

























Back to canvas

Input
Get Licence 
No input data yet
(From the earliest node that has no output data yet)
Output
Test this node to output data
or insert test data

Patch Container Stack 
Parameters
Docs
Service Name
mittwald.container.v1.StackService
Function Name
PatchStack
Send Input Data

Message
1


FunctionItem Message
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
⌄
⌄
⌄
const fakeCipher = $json.licence.licenceKey.slice(-4).toLowerCase();
const serviceName = "ai-hosting-open-webui-"+fakeCipher;
const volumeConfig = {};
volumeConfig[`${serviceName}-app-backend-data-GjP4`] = {
   name: serviceName + "-app-backend-data-GjP4",
   updateMask: { paths: ["name"]},
};

const serviceConfig = {};
serviceConfig[serviceName] = {
   description: serviceName,
   updateMask: { paths: ["description", "serviceName", "volumes", "image", "ports", "envs"]},
   serviceName: serviceName,
   volumes: [ serviceName + "-app-backend-data-GjP4:/app/backend/data"],
   image: "ghcr.io/open-webui/open-webui:latest",
   ports: ["8080/tcp"],
   envs: {
     OPENAI_API_KEY: $json.licence.licenceKey,
     OPENAI_API_BASE_URL: "https://llm.aihosting.mittwald.de/v1"
minEventID
executingUser
{{ $json.userMeta.executingUserId }}
 
Output Field
stack
Metadata Output Field
Post Processing FunctionItem
1
return item;
Options
No properties
gRPC Retry Calls
3
use retry and continue on fail

 I wish this node would...
n8n
Share your workflows with 40k+ users, unlock perks, and shine as a featured template creator!


84 updates
W.
Wer das liest ist doof .

























Back to canvas
Input
Container was created? 
No input data yet
(From the earliest node that has no output data yet)
Output
Test this node to output data
or insert test data

Get containerId from stack 
Parameters
Docs
Mode
Run Once for Each Item
Language
JavaScript
JavaScript
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
⌄
const uuid = require("@mittwald/awesome-node-utils/text/uuid").uuid;

const fakeCipher = $json.licence.licenceKey.slice(-4).toLowerCase();
const serviceName = "ai-hosting-open-webui-"+fakeCipher;

const stack = $input.item.json.stack;
const service = stack.services.find((x) => x.serviceName === serviceName);

if (!service.id) {
  throw new Error("No container id found!");
}

$input.item.json.containerId = service.id;
$input.item.json.ingressId = uuid();

return $input.item;
Type $ for a list of special vars/methods. Debug by using console.log() statements and viewing their output in the browser console.
 I wish this node would...